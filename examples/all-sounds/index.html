<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Himanshu Erande (@rndexe)">
    <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <title>Osmoscape Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js?v=a4c5326" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css?v=a4c5326" integrity="sha512-CIYsJUa3pr1eoXlZFroEI0mq0UIMUqNouNinjpCkSWo3Bx5NRlQ0OuC6DtEB/bDqUWnzXc1gs2X/g52l36N5iw==" crossorigin="anonymous" referrerpolicy="no-referrer" />   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js?v=a4c5326" integrity="sha512-RWosNnDNw8FxHibJqdFRySIswOUgYhFxnmYO3fp+BgCU7gfo4z0oS7mYFBvaa8qu+axY39BmQOrhW3Tp70XbaQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </head>
  <body>
    <div id="aplayer"></div>
  </body>
  <script>
    /**
     * ------------------------------------------------
     * AUTHOR:  Himanshu Erande (rndexe)
     * This code is licensed under MIT license (see LICENSE file for more details)
     * ------------------------------------------------
     */
    //
    let chapter_names = {
      'ch1': '1. Water in space',
      'ch2': '2. Water and Planet',
      'ch3': '3. Water and Atmospheric systems',
      'ch4': '4. Water and Glacier',
      'ch5': '5. Water and Industrial agriculture',
      'ch6': '6. Water and River',
      'ch7': '7. Water and Ocean'
    };
    let files = [], backgroundfiles = [], loopfiles = [];
    let dataURL = "../../assets/data/dataSummary.json";
    console.log('dataURL: ' + dataURL);
    $.getJSON(dataURL, function( data ) {
      console.log('Loaded datasets summary');

      //
      // Load background tracks
      let base_path = '../../../assets/audio/tracks/Baseline_';
      for(let i=0; i < 7; i++){
        let index = (i+1);
        let path = base_path + index + '.mp3';
        backgroundfiles.push(
        {
          name: 'Chapter ' + chapter_names['ch'+index],
          artist: 'Background',
          url: path
        });
      }

      // Load dataset tracks
      datasets = data;
      for (let id in datasets) {
        if (datasets.hasOwnProperty(id)) {
          console.log('Adding sound file for : ' + id);
          let title = datasets[id].title;
          let sound_file_path = datasets[id].audiofile
          let chapter_name = datasets[id].ch
          chapter_name = chapter_name.replace("ch", "Chapter ");
          let loop_property = 
            {
              name: title,
              artist: chapter_name,
              url: sound_file_path
            }
          //
          if(id == '-1')
            loopfiles.unshift(loop_property);
          else
            loopfiles.push(loop_property);
        }
      }

      //
      files = backgroundfiles.concat(loopfiles);
      const ap = new APlayer({
          container: document.getElementById('aplayer'),
          listFolded: false,
          loop: 'one',
          listMaxHeight: 90,
          audio: files
        });
    //
    //
    });
    //
  </script>
</html>
